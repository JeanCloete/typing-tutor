{% extends "base.html" %}

{% block title %}{{ lesson.title }} - Typing Tutor{% endblock %}

{% block content %}
<div class="practice-container">
    <!-- Practice Header -->
    <div class="practice-header">
        <div class="lesson-info">
            <h1>{{ lesson.title }}</h1>
            <div class="lesson-meta">
                <span class="lesson-number">Lesson {{ lesson.number }}</span>
                <span class="accuracy-requirement">
                    <i class="fas fa-target"></i>
                    95% accuracy required
                </span>
            </div>
        </div>
        <a href="{{ url_for('index') }}" class="btn btn-outline">
            <i class="fas fa-arrow-left"></i>
            Back to Lessons
        </a>
    </div>

    <!-- Statistics Panel -->
    <div class="stats-panel">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value" id="time">00:00</div>
                <div class="stat-label">Time</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-tachometer-alt"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value" id="wpm">0</div>
                <div class="stat-label">WPM</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-bullseye"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value" id="accuracy">100</div>
                <div class="stat-label">Accuracy %</div>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="stat-content">
                <div class="stat-value" id="errors">0</div>
                <div class="stat-label">Errors</div>
            </div>
        </div>
    </div>

    <!-- Text Display -->
    <div class="text-display-container">
        <div id="textDisplay" class="text-display">{{ lesson.content }}</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
    </div>

    <!-- Input Area -->
    <div class="input-container">
        <textarea id="inputArea" 
                  class="typing-input" 
                  placeholder="Click here and start typing..."
                  autocomplete="off" 
                  autocorrect="off" 
                  autocapitalize="off" 
                  spellcheck="false"
                  rows="3"></textarea>
    </div>

    <!-- Virtual Keyboard -->
    <div class="keyboard-container">
        <div class="keyboard-header">
            <h3>Finger Position Guide</h3>
            <button id="toggleKeyboard" class="btn btn-sm btn-outline">
                <i class="fas fa-keyboard"></i>
                <span>Hide Keyboard</span>
            </button>
        </div>
        
        <div id="virtualKeyboard" class="virtual-keyboard">
            <!-- Keyboard will be generated by JavaScript -->
        </div>
        
        <div class="finger-legend">
            <div class="finger-color" data-finger="pinky-left" style="background-color: #ff6b6b">Left Pinky</div>
            <div class="finger-color" data-finger="ring-left" style="background-color: #4ecdc4">Left Ring</div>
            <div class="finger-color" data-finger="middle-left" style="background-color: #45b7d1">Left Middle</div>
            <div class="finger-color" data-finger="index-left" style="background-color: #96ceb4">Left Index</div>
            <div class="finger-color" data-finger="thumb" style="background-color: #feca57">Thumbs</div>
            <div class="finger-color" data-finger="index-right" style="background-color: #ff9ff3">Right Index</div>
            <div class="finger-color" data-finger="middle-right" style="background-color: #f38ba8">Right Middle</div>
            <div class="finger-color" data-finger="ring-right" style="background-color: #a6e3a1">Right Ring</div>
            <div class="finger-color" data-finger="pinky-right" style="background-color: #fab387">Right Pinky</div>
        </div>
    </div>

    <!-- Practice Controls -->
    <div class="practice-controls">
        <button id="resetBtn" class="btn btn-secondary">
            <i class="fas fa-redo"></i>
            Restart
        </button>
        <button id="pauseBtn" class="btn btn-secondary" style="display: none;">
            <i class="fas fa-pause"></i>
            Pause
        </button>
    </div>

    <!-- Results Modal -->
    <div id="resultsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="resultsTitle">Lesson Complete!</h2>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="results-stats">
                    <div class="result-stat">
                        <div class="result-value" id="finalWPM">0</div>
                        <div class="result-label">Words Per Minute</div>
                    </div>
                    <div class="result-stat">
                        <div class="result-value" id="finalAccuracy">0%</div>
                        <div class="result-label">Accuracy</div>
                    </div>
                    <div class="result-stat">
                        <div class="result-value" id="finalTime">00:00</div>
                        <div class="result-label">Time Taken</div>
                    </div>
                </div>
                
                <div id="accuracyGate" class="accuracy-gate" style="display: none;">
                    <div class="gate-message">
                        <i class="fas fa-exclamation-triangle"></i>
                        <p>You need 95% accuracy to unlock the next lesson.</p>
                        <p>Keep practicing to improve your accuracy!</p>
                    </div>
                </div>

                <div id="successMessage" class="success-message" style="display: none;">
                    <div class="celebration-icon">ðŸŽ‰</div>
                    <p>Excellent work! You've unlocked the next lesson!</p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="tryAgainBtn" class="btn btn-secondary">
                    <i class="fas fa-redo"></i>
                    Try Again
                </button>
                <button id="nextLessonBtn" class="btn btn-primary" style="display: none;">
                    <i class="fas fa-arrow-right"></i>
                    Next Lesson
                </button>
                <button id="backToLessonsBtn" class="btn btn-outline">
                    <i class="fas fa-list"></i>
                    All Lessons
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Pass lesson data to JavaScript
window.lessonData = {
    id: {{ lesson.id }},
    number: {{ lesson.number }},
    content: {{ lesson.content | tojson }},
    isAuthenticated: {{ current_user.is_authenticated | tojson }}
};
</script>
{% endblock %}

{% block scripts %}
<script>
// Initialize the typing practice when page loads
document.addEventListener('DOMContentLoaded', function() {
    initTypingPractice();
});
</script>
{% endblock %}
